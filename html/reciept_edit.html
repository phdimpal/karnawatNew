<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8"/>
<title>Karnawat | Reciept</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="" name="description"/>
<meta content="" name="author"/>
<!-- BEGIN GLOBAL MANDATORY STYLES -->
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all" rel="stylesheet" type="text/css"/>
<link href="assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
<link href="assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css"/>
<link href="assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="assets/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css"/>
<link href="assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css"/>
<link href="assets/global/plugins/select2/select2.css" rel="stylesheet" type="text/css"/>
<link href="assets/global/css/components.css" id="style_components" rel="stylesheet" type="text/css"/>
<link href="assets/global/css/plugins.css" rel="stylesheet" type="text/css"/>
<link href="assets/admin/layout/css/layout.css" rel="stylesheet" type="text/css"/>
<link href="assets/admin/layout/css/themes/darkblue.css" rel="stylesheet" type="text/css" id="style_color"/>
<link href="assets/admin/layout/css/custom.css" rel="stylesheet" type="text/css"/>
<link href="assets/css/custom.css" rel="stylesheet" type="text/css"/>
<!-- END THEME STYLES -->
<link rel="shortcut icon" href="favicon.ico"/>
</head>

<body class="page-header-fixed page-quick-sidebar-over-content">
<!-- BEGIN HEADER -->
<div class="page-header -i navbar navbar-fixed-top">
	<!-- BEGIN HEADER INNER -->
	<div class="page-header-inner">
		<!-- BEGIN LOGO -->
		<div class="page-logo">
			<a href="index.html">
				<h3>KARNAWAT</h3>
			</a>
			<div class="menu-toggler sidebar-toggler hide">
			</div>
		</div>
		<!-- END LOGO -->
		<!-- BEGIN RESPONSIVE MENU TOGGLER -->
		<a href="javascript:;" class="menu-toggler responsive-toggler" data-toggle="collapse" data-target=".navbar-collapse">
		</a>
		<!-- END RESPONSIVE MENU TOGGLER -->
		<!-- BEGIN TOP NAVIGATION MENU -->
		<div class="top-menu">
			<ul class="nav navbar-nav pull-right">
				
				
				<li class="dropdown dropdown-user">
					<a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
					<img alt="" class="img-circle" src=src="assets/admin/layout/img/default.jpg"/>
					<span class="username username-hide-on-mobile">
					Nick </span>
					<i class="fa fa-angle-down"></i>
					</a>
					<ul class="dropdown-menu dropdown-menu-default">
						<li>
							<a href="extra_profile.html">
							<i class="icon-user"></i> My Profile </a>
						</li>
						<li>
							<a href="login.html">
							<i class="icon-key"></i> Log Out </a>
						</li>
					</ul>
				</li>
				<!-- END USER LOGIN DROPDOWN -->
				<!-- BEGIN QUICK SIDEBAR TOGGLER -->
				<!-- DOC: Apply "dropdown-dark" class after below "dropdown-extended" to change the dropdown styte -->
				<li class="dropdown dropdown-quick-sidebar-toggler">
					<a href="javascript:;" class="dropdown-toggle">
					<i class="icon-logout"></i>
					</a>
				</li>
				<!-- END QUICK SIDEBAR TOGGLER -->
			</ul>
		</div>
		<!-- END TOP NAVIGATION MENU -->
	</div>
	<!-- END HEADER INNER -->
</div>
<!-- END HEADER -->
<div class="clearfix">
</div>
<!-- BEGIN CONTAINER -->
<div class="page-container">
	<!-- BEGIN SIDEBAR -->
	<div class="page-sidebar-wrapper">
	
		<div class="page-sidebar navbar-collapse collapse">
			
			<ul class="page-sidebar-menu " data-keep-expanded="false" data-auto-scroll="true" data-slide-speed="200">
				<!-- DOC: To remove the sidebar toggler from the sidebar you just need to completely remove the below "sidebar-toggler-wrapper" LI element -->
				<li class="sidebar-toggler-wrapper">
					<!-- BEGIN SIDEBAR TOGGLER BUTTON -->
					<div class="sidebar-toggler">
					</div>
					<!-- END SIDEBAR TOGGLER BUTTON -->
				</li>
				
					<li class="start active open">
					<a href="javascript:;">
						<i class="icon-home"></i>
						<span class="title">Dashboard</span>
					</a>
				</li>
				<li>
					<a href="javascript:;">
					<i class="fa fa-folder-open"></i>
					
					<span class="title">Master</span>
				
					<span class="arrow"></span>
					</a>
					<ul class="sub-menu">
						<li >
							<a href="company_list.html">
							<i class="icon-bar-chart"></i>
							Company</a>
						</li>
						<li>
							<a href="unit_list.html">
							<i class="icon-bar-chart"></i>
							Units</a>
						</li>
					     <li >
							<a href="customer_list.html">
							<i class="icon-bar-chart"></i>
							Customer</a>
						</li>
						<li >
							<a href="users_master_list.html">
							<i class="icon-bar-chart"></i>
							User</a>
						</li>

						<li >
							<a href="financial_year.html">
							<i class="icon-bar-chart"></i>
							Financial Year</a>
							
						</li>
						<li >
							<a href="financial_month.html">
							<i class="icon-bar-chart"></i>
							Financial Month</a>
						</li>
						<li>
							<a href="transporter_add.html">
							<i class="icon-bar-chart"></i>
							Transporter</a>
						</li>
					</ul>
				</li>

				<li>
					<a href="javascript:;">
					<i class="fa fa-folder-open"></i>
					
					<span class="title">Performa Invoice</span>
				
					<span class="arrow"></span>
					</a>
					<ul class="sub-menu">
						<li>
							<a href="performa_invoice_add.html">
							<i class="fa fa-plus"></i>
							Add</a>
						</li>
						<li >
							<a href="performa_invoice_list.html">
							<i class="fa fa-file"></i>
							List</a>
						</li>
					
					</ul>
				</li>
				<li>
						<a href="javascript:;">
						<i class="fa fa-folder-open"></i>
						
						<span class="title">Invoice</span>
					
						<span class="arrow"></span>
						</a>
						<ul class="sub-menu">
							<li >
								<a href="pull_invoice.html">
								<i class="fa fa-plus"></i>
								Add</a>
							</li>
							<li >
								<a href="invoice_list.html">
								<i class="fa fa-file"></i>
								List</a>
							</li>
							<li >
									<a href="invoice_export_list.html">
									<i class="fa fa-file"></i>
									Export List</a>
								</li>
						</ul>
					</li>
					<li>
						<a href="javascript:;">
						<i class="icon-folder"></i>
						<span class="title">Vouchers</span>
						<span class="arrow "></span>
						</a>
						<ul class="sub-menu">
							<li>
								<a href="javascript:;">
								<i class="icon-settings"></i> Reciepts <span class="arrow"></span>
								</a>
								<ul class="sub-menu">
									<li>
										<a href="reciept_add.html"><i class="icon-power"></i>Add</a>
									</li>
									<li>
										<a href="reciept_list.html"><i class="icon-paper-plane"></i>List</a>
									</li>
								</ul>
							</li>
						</ul>
					</li>				
			</ul>
			<!-- END SIDEBAR MENU -->
		</div>
	</div>
	<!-- END SIDEBAR -->
	<!-- BEGIN CONTENT -->
	<div class="page-content-wrapper">
		<div class="page-content">
			<h3 class="page-title">
				Reciept <small>Voucher</small>
			</h3>
			<div class="page-bar">
				<ul class="page-breadcrumb">
					<li>
						<i class="fa fa-home"></i>
						<a href="index.html">Home</a>
						<i class="fa fa-angle-right"></i>
					</li>
					<li>
						<a href="reciept_list.html">Reciept Voucher</a>
					</li>
				</ul>
			</div>
			<div class="portlet box green util-btn-group">
				<div class="portlet-title">
					<div class="caption">
						<i class="fa fa-gift"></i>Edit Reciept Voucher
					</div>
				
				</div>
				<div class="portlet-body form">
					<form id="company_form" action="#" class="horizontal-form">
						<div class="form-body">
							<div class="row">
								<div class="col-md-4">
									<div class="form-group">
										<label class="control-label">Vouchers No.</label>
										<br/>
										<span>
											<label>001</label>
										</span>	
									</div>
                                </div>
                                <div class="col-md-4"></div>
								<div class="col-md-4">
									<div class="form-group">
										<label class="control-label">Transaction Date</label>
										<input type="text" id="transaction_date" name="transaction_date" class="form-control date-picker" placeholder="Date">
									</div>
								</div>
							</div>	
                            <div class="row">
                                    <div class="col-md-12">
                                        <div class="table-responsive">
                                             <table id="MainTable" class="table table-condensed table-striped" width="100%">
                                                <thead>
                                                    <tr>
                                                        <td></td>
                                                        <th>Particulars</th>
                                                        <th>Debit</th>
                                                        <th>Credit</th>
                                                        <th width="10%"></th>
                                                    </tr>
                                                </thead>
                                                <tbody id='MainTbody' class="tab">
                                                    <tr class="MainTr">
                                                        <td width="10%" valign="top">
                                                            <select name="cr_dr" class="form-control select2 cr_dr" readonly>
                                                                <option value="Cr" selected="selected">Cr</option>
                                                                
                                                            </select>
                                                        </td>
                                                        <td width="65%" valign="top">
                                                                <select name="ledger" class="form-control select2 ledger" >
                                                                        <option value="">---Select---</option>
                                                                        <option value="Cash" default_days="2" open_window="bank">Bank</option>
                                                                        <option value="Karnawat" default_days="2" open_window="party">Karnawat</option>
                                                                </select>
                                                            <div class="window" style="margin:auto;"></div>
                                                        </td>
                                                        <td width="10%" valign="top">
                                                            <input type="text" class="form-control debitBox calculate_total" name="debit" style="display: none;">
                                                        </td>
                                                        <td width="10%" valign="top">
                                                                <input type="text" class="form-control creditBox calculate_total" name="credit"> 
                                                        </td>
                                                        <td align="center"  width="10%" valign="top">
                                                        </td>
                                                      </tr>
                                                 </tbody>
                                                 <tfoot>
                                                    <tr style="border-top:double;">
                                                        <td colspan="2" valign="top" >	
                                                            <button type="button" class="AddMainRow btn btn-default input-sm"><i class="fa fa-plus"></i></button>
                                                            <input type="hidden" id="totalBankCash">
                                                        </td>
                                                        <td valign="top"><input type="text" class="form-control input-sm rightAligntextClass noBorder " name="totalMainDr" id="totalMainDr" readonly></td>
                                                        <td valign="top"><input type="text" class="form-control input-sm rightAligntextClass noBorder" name="totalMainCr" id="totalMainCr" readonly></td>
                                                        <td></td>
                                                    </tr>
                                                </tfoot>
                                             </table>
                                          </div>
                                    </div>
                                </div>
                                <div class="row">
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label>Narration </label>
                                                 <textarea name="narration" class="form-control" rows="5" cols="5"></textarea>   
                                            </div>
                                        </div>
                                </div>
							<div class="form-actions right">
								<button type="button" class="btn default">Cancel</button>
								<button type="submit" class="btn green"><i class="fa fa-check"></i> Edit</button>
							</div>							
						</div>	
					</form>	
				</div>
			</div>	
		</div>
	</div>
</div>

<div class="page-footer">
	<div class="page-footer-inner">
		 2014 &copy; Metronic by keenthemes.
	</div>
	<div class="scroll-to-top">
		<i class="icon-arrow-up"></i>
	</div>
</div>
<!----->


<table id="sampleForRef" style="display:none;" width="100%">
	<tbody>
		<tr>
			<td width="20%" valign="top"> 
				<input type="hidden" class="ledgerIdContainer" />
                <input type="hidden" class="companyIdContainer" />
                <select name="refdetail" class="form-control refType">
                    <option value="">---Select---</option>
                    <option value="New Ref">New Ref</option>
                    <option value="Against">Against</option>
                    <option value="Advance">Advance</option>
                    <option value="On Account">On Account</option>
                </select>
			</td>
			<td width="" valign="top">
                   <input type="text" placeholder="Reference Name" class="form-control ref_name" name="ref_name"> 
            </td>
			
            <td width="20%" style="padding-right:0px;" valign="top">
                    <input type="text" placeholder="Amount" class="form-control calculation" name="amount"> 
			</td>
            <td width="10%" style="padding-left:0px;" valign="top">
                    <select name="type_cr_dr" class="form-control refDrCr">
                            <option value="">---Select---</option>
                            <option value="Dr">Dr</option>
                            <option value="Cr">Cr</option>
                    </select>
			</td>
            <td width="15%" style="padding-left:0px;" valign="top">
                <input type="text" class="form-control dueDays" name="due_days">
			</td>
			<td width="5%" align="right" valign="top">
				<a class="delete-tr-ref" href="#" role="button" style="margin-bottom: 5px;"><i class="fa fa-times"></i></a>
			</td>
		</tr>
	</tbody>
</table>

<table id="sampleForBank" style="display:none;" width="100%">
	<tbody>
		<tr>
			<td width="30%" valign="top">
                <select name="mode_of_payment" class="form-control paymentType">
                    <option value="">---Select---</option>
                    <option value="Cheque">Cheque</option>
                    <option value="NEFT/RTGS">NEFT/RTGS</option>
                </select>
			</td>
			<td width="30%" valign="top">
                <input type="text" class="form-control cheque_no" placeholder="Chequq No" name="cheque_no">
			</td>
			
			<td width="30%" valign="top">
                    <input type="text" class="form-control date-picker cheque_date" placeholder="Cheque Date"ame="cheque_date">
			</td>
			
			
		</tr>
	</tbody>
</table>
<table id="sampleMainTable" style="display:none;" width="100%">
        <tbody class="sampleMainTbody">
            <tr class="MainTr">
                
                <td width="10%" valign="top">
                    <select name="cr_dr" class="form-control select2 cr_dr" >
                        <option value="Cr" >Cr</option>
                        <option value="Dr" selected="selected">Dr</option>
                    </select>
                </td>
                <td width="65%" valign="top">
                    <select name="ledger_id" class="form-control select2 ledger" >
                        <option value="">---Select---</option>
                        <option value="Cash" open_window="bank" default_days="10">Bank</option>
                        <option value="Karnawat" open_window="party" default_days="2">Karnawat</option>
                    </select> 
                    <div class="window" style="margin:auto;"></div>
                </td>
                <td width="10%" valign="top">
                        <input type="text" class="form-control debitBox calculate_total" name="debit">
                </td>
                <td width="10%" valign="top">
                        <input type="text" class="form-control creditBox calculate_total" style="display: none;" name="credit"> 
                </td>
                <td align="center"  width="10%" valign="top">
                    <a class="btn btn-danger delete-tr btn-xs" href="#" role="button" style="margin-bottom: 5px;"><i class="fa fa-times"></i></a>
                </td>
            </tr>
            
        </tbody>
        <tfoot >
            <tr>
                <td colspan="2" >	
                    <button type="button" class="add_row btn btn-default input-sm"><i class="fa fa-plus"></i> Add row</button>
                </td>
            </tr>
        </tfoot>
    </table>
<!----->
<script src="assets/global/plugins/jquery.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/jquery-migrate.min.js" type="text/javascript"></script>
<!-- IMPORTANT! Load jquery-ui.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
<script src="assets/global/plugins/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
<!-- END CORE PLUGINS -->
<script type="text/javascript" src="assets/global/plugins/bootstrap-select/bootstrap-select.min.js"></script>
<script src="assets/global/plugins/select2/select2.min.js" type="text/javascript"></script>
<script type="text/javascript" src="assets/global/plugins/jquery-multi-select/js/jquery.multi-select.js"></script>

<script src="assets/global/js/jquery.validate.min.js" type="text/javascript"></script>
<script src="assets/global/js/additional-methods.min.js" type="text/javascript"></script>

<script src="assets/global/scripts/metronic.js" type="text/javascript"></script>
<script src="assets/admin/layout/scripts/layout.js" type="text/javascript"></script>
<script src="assets/admin/layout/scripts/quick-sidebar.js" type="text/javascript"></script>
<script src="assets/admin/layout/scripts/demo.js" type="text/javascript"></script>
<script src="assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js" type="text/javascript"></script>
<script src="assets/admin/pages/scripts/components-pickers.js" type="text/javascript"></script>
<script src="assets/admin/pages/scripts/components-dropdowns.js"></script>
<!-- END PAGE LEVEL SCRIPTS -->
<script>
    function round(value, exp) {
		  if (typeof exp === 'undefined' || +exp === 0)
			return Math.round(value);

		  value = +value;
		  exp = +exp;

		  if (isNaN(value) || !(typeof exp === 'number' && exp % 1 === 0))
			return 0;

		  // Shift
		  value = value.toString().split('e');
		  value = Math.round(+(value[0] + 'e' + (value[1] ? (+value[1] + exp) : exp)));

		  // Shift back
		  value = value.toString().split('e');
		  return +(value[0] + 'e' + (value[1] ? (+value[1] - exp) : -exp));
		}
jQuery(document).ready(function() {    
	Metronic.init(); // init metronic core componets
	Layout.init(); // init layout
	QuickSidebar.init(); // init quick sidebar
	ComponentsPickers.init();
	ComponentsDropdowns.init();
  //////start code for reference detial
  $('.delete-tr').die().live('click',function() 
			{	
                var count=$(this).closest("table tbody").find("tr").length;
               
               if(count >= 2)
                {
				    $(this).closest('tr.MainTr').remove();
				    renameMainRows();
                }
			});

  $('.delete-tr-ref').die().live('click',function() 
			{	
                var SelectedTr=$(this).closest('tr.MainTr');
                var count=$(this).closest("table tbody").find("tr").length;
               
                 if(count >= 2)
                  {
				        $(this).closest('tr').remove();
                        calculation(SelectedTr);
                        renameMainRows();
                        renameRefRows(SelectedTr);
                  }      
                        
			});
    $('.paymentType').die().live('change',function(){
        
        var type=$(this).val();	
        var currentRefRow=$(this).closest('tr');
        var SelectedTr=$(this).closest('tr.MainTr');
        if(type=='NEFT/RTGS'){
            currentRefRow.find('td:nth-child(2) input').val('');
            currentRefRow.find('td:nth-child(3) input').val('');
            currentRefRow.find('td:nth-child(2)').hide();
            currentRefRow.find('td:nth-child(3)').hide();
            renameBankRows(SelectedTr);
        }
        else{
            currentRefRow.find('td:nth-child(2)').show();
            currentRefRow.find('td:nth-child(3)').show();
            renameBankRows(SelectedTr);
        }
        
    });
			
    $('.refDrCr').die().live('change',function(){
        var SelectedTr=$(this).closest('tr.MainTr');
        renameRefRows(SelectedTr);
    });      

    $('.refType').die().live('change',function(){
    var type=$(this).val();
    var currentRefRow=$(this).closest('tr');
    var ledger_id=$(this).closest('tr.MainTr').find('select.ledger option:selected').val();
    var due_days=$(this).closest('tr.MainTr').find('select.ledger option:selected').attr('default_days');
    if(type=='Against'){
        $(this).closest('tr').find('td:nth-child(2)').html('Loading Ref List...');
        var url='';
        url=url+'/'+ledger_id;
        $.ajax({
            url: url,
        }).done(function(response) { 
            currentRefRow.find('td:nth-child(2)').html(response);
            currentRefRow.find('td:nth-child(5)').html('');
        });
    }else if(type=='On Account'){
        currentRefRow.find('td:nth-child(2)').html('');
        currentRefRow.find('td:nth-child(5)').html('');
    }else{
        currentRefRow.find('td:nth-child(2)').html('<input type="text" class="form-control input-sm ref_name " placeholder="Reference Name">');
        currentRefRow.find('td:nth-child(5)').html('<input type="text" class="form-control input-sm rightAligntextClass dueDays " placeholder="Due Days">');
        currentRefRow.find('td:nth-child(5) input.dueDays').val(due_days);
    }
    var SelectedTr=$(this).closest('tr.MainTr');
    renameRefRows(SelectedTr);
    });
			
			
        $('.ledger').die().live('change',function(){
            var openWindow=$(this).find('option:selected').attr('open_window');
            
            if(openWindow=='party'){
                var SelectedTr=$(this).closest('tr.MainTr');
                var windowContainer=$(this).closest('td').find('div.window');
                windowContainer.html('');
                windowContainer.html('<table width=90% class=refTbl><tbody></tbody><tfoot><tr style=border-top:double#a5a1a1><td colspan=2><a role=button class=addRefRow>Add Row</a></td><td><input type="text" class="form-control input-sm rightAligntextClass total calculation noBorder" readonly ></td><td valign=top><input type="text" class="form-control input-sm total_type calculation noBorder" readonly ></td></tr></tfoot></table>');
                AddRefRow(SelectedTr);
            }
            else if(openWindow=='bank'){
                var SelectedTr=$(this).closest('tr.MainTr')
                var windowContainer=$(this).closest('td').find('div.window');
                windowContainer.html('');
                windowContainer.html('<table width=90% ><tbody></tbody><tfoot><td colspan=4></td></tfoot></table>');
                AddBankRow(SelectedTr);
            }
            else{
                var windowContainer=$(this).closest('td').find('div.window');
                windowContainer.html('');
            }
            renameMainRows();
        });
        $('.cr_dr').die().live('change',function(){
            var cr_dr=$(this).val();
         
            if(cr_dr=='Cr'){
                $(this).closest('tr').find('.debitBox').val('');
                $(this).closest('tr').find('.debitBox').hide();
                $(this).closest('tr').find('.creditBox').show();
            }else{
                $(this).closest('tr').find('.creditBox').val('');
                $(this).closest('tr').find('.debitBox').show();
                $(this).closest('tr').find('.creditBox').hide();
            }
            renameMainRows();
        });
			
        $('.AddMainRow').die().live('click',function(){ 
            addMainRow();
        });
        function addMainRow(){
				var tr=$('#sampleMainTable tbody.sampleMainTbody tr.MainTr').clone();
				$('#MainTable tbody#MainTbody').append(tr);
				renameMainRows();
			}
			
			function renameMainRows(){
				var i=0; var main_debit=0; var main_credit=0; var count_bank_cash=0;
				$('#MainTable tbody#MainTbody tr.MainTr').each(function(){
					$(this).attr('row_no',i);
					var cr_dr=$(this).find('td:nth-child(1) select.cr_dr option:selected').val();
					var is_cash_bank=$(this).find('td:nth-child(2) option:selected').attr('bank_and_cash');
					$(this).find('td:nth-child(1) select.cr_dr').attr({name:'receipt_rows['+i+'][cr_dr]',id:'receipt_rows-'+i+'-cr_dr'});
					$(this).find('td:nth-child(2) select.ledger').attr({name:'receipt_rows['+i+'][ledger_id]',id:'receipt_rows-'+i+'-ledger_id'}).select2();
					$(this).find('td:nth-child(3) input.debitBox').attr({name:'receipt_rows['+i+'][debit]',id:'receipt_rows-'+i+'-debit'});
					$(this).find('td:nth-child(4) input.creditBox').attr({name:'receipt_rows['+i+'][credit]',id:'receipt_rows-'+i+'-credit'});
					
					if(cr_dr=='Dr'){
						$(this).find('td:nth-child(3) input.debitBox');
						$(this).find('td:nth-child(4) input.creditBox');
						$(this).find('td:nth-child(4) span.help-block-error').remove();
						var debit_amt=parseFloat($(this).find('td:nth-child(3) input.debitBox').val());
						if(!debit_amt){
							debit_amt=0;
						}
						main_debit=round(main_debit+debit_amt, 2);
						if(is_cash_bank=='yes'){
						 count_bank_cash++;
						}
						
					}else{
						$(this).find('td:nth-child(3) input.debitBox');
						$(this).find('td:nth-child(3) span.help-block-error').remove();
						$(this).find('td:nth-child(4) input.creditBox');
						var credit_amt=parseFloat($(this).find('td:nth-child(4) input.creditBox').val());
						if(!credit_amt){
							credit_amt=0;
						}
						main_credit=round(main_credit+credit_amt, 2);
						
					}
					i++;      
					var type=$(this).find('td:nth-child(2) option:selected').attr('open_window'); 
					var SelectedTr=$(this).closest('tr.MainTr');
					if(type=='party'){
						renameRefRows(SelectedTr);
					}
					if(type=='bank'){
						renameBankRows(SelectedTr);
					}
				});
				$('#MainTable tfoot tr td:nth-child(2) input#totalMainDr').val(main_debit);
				$('#MainTable tfoot tr td:nth-child(3) input#totalMainCr').val(main_credit);
				$('#MainTable tfoot tr td:nth-child(1) input#totalBankCash').val(count_bank_cash);
			}
			
			$('.addBankRow').die().live('click',function(){
				var SelectedTr=$(this).closest('tr.MainTr');
				AddBankRow(SelectedTr);
				
			});
		
			
			function AddBankRow(SelectedTr){
				var bankTr=$('#sampleForBank tbody tr').clone();
				//console.log(bankTr);
				SelectedTr.find('td:nth-child(2) div.window table tbody').append(bankTr);
				renameBankRows(SelectedTr);
			}
			
			
			function renameBankRows(SelectedTr){
				var row_no=SelectedTr.attr('row_no');
				SelectedTr.find('td:nth-child(2) div.window table tbody tr').each(function(){
					var type = SelectedTr.find('td:nth-child(1) select.paymentType option:selected').val(); 
					//alert(type);
					$(this).find('td:nth-child(1) select.paymentType').attr({name:'receipt_rows['+row_no+'][mode_of_payment]',id:'receipt_rows-'+row_no+'-mode_of_payment'});
					$(this).find('td:nth-child(2) input.cheque_no').attr({name:'receipt_rows['+row_no+'][cheque_no]',id:'receipt_rows-'+row_no+'-cheque_no'});
					$(this).find('td:nth-child(3) input.cheque_date').attr({name:'receipt_rows['+row_no+'][cheque_date]',id:'receipt_rows-'+row_no+'-cheque_date'}).datepicker();
				
					if(type=='Cheque')
					{ 
						$(this).find('td:nth-child(2) input.cheque_no').rules('add','required');
						$(this).find('td:nth-child(3) input.cheque_date').rules('add','required');
					}
					else if(type=='NEFT/RTGS')
					{
						$(this).find('td:nth-child(2) input').rules('remove','required');
						$(this).find('td:nth-child(3) input').rules('remove','required');
					}
				});
			}
			
			$('.addRefRow').die().live('click',function(){
				var SelectedTr=$(this).closest('tr.MainTr');
				
				AddRefRow(SelectedTr);
			});
			
			function AddRefRow(SelectedTr){
				var refTr=$('#sampleForRef tbody tr').clone();
				var due_days=SelectedTr.find('td:nth-child(2) select.ledger option:selected').attr('default_days');
				refTr.find('td:nth-child(5) input.dueDays').val(due_days);
				//console.log(refTr);
				SelectedTr.find('td:nth-child(2) div.window table tbody').append(refTr);
				renameRefRows(SelectedTr);
			}
			
			function renameRefRows(SelectedTr){
				var i=0;
				
				var ledger_id=SelectedTr.find('td:nth-child(2) select.ledger').val();
				var cr_dr=SelectedTr.find('td:nth-child(1) select.cr_dr option:selected').val();
				if(cr_dr=='Dr'){
					var eqlClassDr=SelectedTr.find('td:nth-child(3) input.debitBox').attr('id');
					var mainAmt=SelectedTr.find('td:nth-child(3) input.debitBox').val();
				}else{
					var eqlClassCr=SelectedTr.find('td:nth-child(4) input.creditBox').attr('id');
					var mainAmt=SelectedTr.find('td:nth-child(4) input.creditBox').val();
				}
				
				SelectedTr.find('input.ledgerIdContainer').val(ledger_id);
				SelectedTr.find('input.companyIdContainer').val(1);
				var row_no=SelectedTr.attr('row_no');
				if(SelectedTr.find('td:nth-child(2) div.window table tbody tr').length>0){
				SelectedTr.find('td:nth-child(2) div.window table tbody tr').each(function(){
					$(this).find('td:nth-child(1) input.companyIdContainer').attr({name:'receipt_rows['+row_no+'][reference_details]['+i+'][company_id]',id:'receipt_rows-'+row_no+'-reference_details-'+i+'-company_id'});
					$(this).find('td:nth-child(1) input.ledgerIdContainer').attr({name:'receipt_rows['+row_no+'][reference_details]['+i+'][ledger_id]',id:'receipt_rows-'+row_no+'-reference_details-'+i+'-ledger_id'});
					
					$(this).find('td:nth-child(1) select.refType').attr({name:'receipt_rows['+row_no+'][reference_details]['+i+'][type]',id:'receipt_rows-'+row_no+'-reference_details-'+i+'-type'});
					var is_select=$(this).find('td:nth-child(2) select.refList').length;
					var is_input=$(this).find('td:nth-child(2) input.ref_name').length;
					if(is_select){
						$(this).find('td:nth-child(2) select.refList').attr({name:'receipt_rows['+row_no+'][reference_details]['+i+'][ref_name]',id:'receipt_rows-'+row_no+'-reference_details-'+i+'-ref_name'});
					}else if(is_input){
						$(this).find('td:nth-child(2) input.ref_name').attr({name:'receipt_rows['+row_no+'][reference_details]['+i+'][ref_name]',id:'receipt_rows-'+row_no+'-reference_details-'+i+'-ref_name'});
						$(this).find('td:nth-child(5) input.dueDays').attr({name:'receipt_rows['+row_no+'][reference_details]['+i+'][due_days]',id:'receipt_rows-'+row_no+'-reference_details-'+i+'-due_days'});
					}
					var Dr_Cr=$(this).find('td:nth-child(4) select option:selected').val();
					if(Dr_Cr=='Dr'){
						$(this).find('td:nth-child(3) input').attr({name:'receipt_rows['+row_no+'][reference_details]['+i+'][debit]',id:'receipt_rows-'+row_no+'-reference_details-'+i+'-debit'});;
					}else{
						$(this).find('td:nth-child(3) input').attr({name:'receipt_rows['+row_no+'][reference_details]['+i+'][credit]',id:'receipt_rows-'+row_no+'-reference_details-'+i+'-credit'});;
					}
					i++;
				});
				var total_type=SelectedTr.find('td:nth-child(2) div.window table.refTbl tfoot tr td:nth-child(3) input.total_type').val();
					if(total_type=='Dr'){
					 eqlClass=eqlClassDr;
					}else{
					 eqlClass=eqlClassCr;
					}

				
				SelectedTr.find('td:nth-child(2) div.window table.refTbl tfoot tr td:nth-child(2) input.total')
				.attr({name:'receipt_rows['+row_no+'][total]',id:'receipt_rows-'+row_no+'-total'})
						.rules('add', {
							equalTo: '#'+eqlClass,
							messages: {
								equalTo: 'Enter bill wise details upto '+mainAmt+' '+cr_dr
							}
						});
				}
			}
            $('.calculate_total').die().live('keyup',function()
			{ 
				 renameMainRows();
			});
			$('.calculation').die().live('keyup',function()
			{ 
				var SelectedTr=$(this).closest('tr.MainTr');
				calculation(SelectedTr);
				
			});
			$('.calculation').die().live('change',function()
			{ 
				var SelectedTr=$(this).closest('tr.MainTr');
				calculation(SelectedTr);
				
			});
			function calculation(SelectedTr)
			{
				var total_debit=0;var total_credit=0; var remaining=0; var i=0;
				SelectedTr.find('td:nth-child(2) div.window table tbody tr').each(function(){
				var Dr_Cr=$(this).find('td:nth-child(4) select option:selected').val();
				//console.log(Dr_Cr);
				var amt= parseFloat($(this).find('td:nth-child(3) input').val());
				if(!amt){amt=0; }
					if(Dr_Cr=='Dr'){
						total_debit=round(total_debit+amt, 2);
						
					}
					else if(Dr_Cr=='Cr'){
						total_credit=round(total_credit+amt, 2);
						//console.log(total_credit);
					}
					
					remaining=round(total_debit-total_credit, 2);
					
					if(remaining>0){
						//console.log(remaining);
						$(this).closest('table').find(' tfoot td:nth-child(2) input.total').val(remaining);
						$(this).closest('table').find(' tfoot td:nth-child(3) input.total_type').val('Dr');
					}
					else if(remaining<0){
						remaining=Math.abs(remaining)
						$(this).closest('table').find(' tfoot td:nth-child(2) input.total').val(remaining);
						$(this).closest('table').find(' tfoot td:nth-child(3) input.total_type').val('Cr');
					}
					else{
					$(this).closest('table').find(' tfoot td:nth-child(2) input.total').val('0');
					$(this).closest('table').find(' tfoot td:nth-child(3) input.total_type').val('');	
					}
					
				});
				renameRefRows(SelectedTr);
					
				i++;
			}
  //////ends code for reference detial


});


</script>
<!-- END JAVASCRIPTS -->
</body>
<!-- END BODY -->
</html>